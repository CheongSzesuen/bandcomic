<template>
	<div class="demo-page">
		<img
			if="{{ global.screenShape != 'circle' }}"
			class="leftButton top"
			src="/common/back.png"
			@click="routeBack"
		/>
		<img
			if="{{ global.screenShape != 'circle' }}"
			class="rightButton top"
			src="/common/info.png"
			@click="routeAbout"
		/>

		<text class="time">{{ time }}</text>
		<text
			class="title"
			@click="
				() => {
					if (global.screenShape == 'circle') {
						routeBack();
					}
				}
			"
		>
			<span class="iconfont" if="{{ global.screenShape == 'circle' }}">
				&#xe6bc;
			</span>
			<span>详情</span>
		</text>
		<scroll
			id="scrollId"
			class="box"
			scroll-x="true"
			scroll-y="true"
			bounces="true"
		>
			<image
				class="cover"
				@complete="getPhoto"
				src="{{ data.cover || '/common/loading.png' }}"
				alt="/common/loading.png"
				onclick="toPhoto"
				style="{{ `width:${size.width}px;height:${size.height}px;` }}"
			></image>
			<text class="title1">{{ data.name }}</text>
			<div class="detail">
				<text if="{{ data.gid }}">本子GID：{{ data.gid }}</text>
				<text else>本子ID：{{ data.item_id }}</text>
				<text>页数：{{ data.page_count }}</text>
				<text if="{{ data.views }}">观看数：{{ data.views }}</text>
				<text if="{{ data.rate }}">评分：{{ data.rate }}</text>
			</div>
			<div class="padding"></div>
		</scroll>
		<img
			if="{{ global.screenShape != 'circle' }}"
			class="rightButton bottom"
			src="/common/dl.png"
			@click="download"
		/>
		<img
			if="{{ global.screenShape == 'circle' }}"
			class="bottom"
			src="/common/dl_s4.png"
			@click="download"
		/>
	</div>
</template>

<script>
import router from "@system.router";

const { screenSize, getTime } = global;

export default {
	private: {
		data: {
			name: "",
			item_id: "",
			views: "",
			page_count: 0,
			cover: "",
		},
		time: "",
		size: { width: 200, height: 200 },
	},

	onShow() {
		this.time = getTime();
	},

	onInit() {
		this.data = JSON.parse(this.data);
		this.processData();
	},

	processData() {
		if (global.API_SETTING[global.API_SETTING.using].type === "jmcomic") {
			this.data.cover = `${
				global.API_SETTING[global.API_SETTING.using].apiUrl
			}/album/${this.data.item_id}/cover?w=400`;
		}
	},

	getPhoto(value) {
		this.size.width = screenSize.width / 2;
		this.size.height = ((screenSize.width / value.width) * value.height) / 2;
	},

	toPhoto() {
		router.push({
			uri: "/pages/photo",
			params: {
				id: this.data.item_id,
				page_count: this.data.page_count,
			},
		});
	},

	download() {
		router.push({
			uri: "/pages/offline",
			params: {
				id: this.data.item_id,
				page_count: this.data.page_count,
				name: this.data.name,
				cover: this.data.cover,
				dl: true,
			},
		});
	},

	routeBack() {
		router.back();
	},

	routeAbout() {
		router.push({
			uri: "/pages/about",
		});
	},
};
</script>

<style>
@import "../../common/base.css";

.demo-page {
	display: flex;
	flex-direction: column;
	align-items: center;
	color: #ffffff;
}

text {
	font-size: 24px;
}

.title1 {
	font-size: 28px;
	text-align: center;
	margin-bottom: 4px;
	margin-top: 10px;
	width: 80%;
	lines: 2;
	font-weight: bold;
	text-overflow: ellipsis;
}

.detail {
	width: 80%;
	flex-direction: column;
	align-items: flex-start;
}

.box {
	flex-direction: column;
	align-items: center;
}

@media screen and (shape: circle) {
	.padding {
		width: 1px;
		height: 20%;
	}

	.box {
		width: 100%;
		height: 80%;
	}
}

@media screen and (shape: rect) {
	.padding {
		width: 1px;
		height: 10%;
	}

	.box {
		width: 100%;
		height: 80%;
	}
}
</style>
